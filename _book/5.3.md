#### 5.3 基本模組 (ALU / BusIO / CMP / CSR / RegFile / BusIO)

在五階段管線的 RISC-V 處理器設計中，各個基本模組共同協作，實現指令的正確執行。這些模組包括算術邏輯單元 (ALU)、總線輸入輸出模組 (BusIO)、比較器 (CMP)、控制與狀態寄存器 (CSR)、寄存器檔 (RegFile) 等。以下是對這些模組的詳細介紹。

##### 1. 算術邏輯單元 (ALU)

- **功能**：ALU 是處理器的核心組件，負責執行各種算術和邏輯運算，如加法、減法、邏輯運算（AND、OR、NOT）等。
- **元件**：
	- **運算控制單元**：根據指令的操作碼設定 ALU 的運算模式。
	- **輸入端口**：接收來自暫存器檔或其他模組的數據。
	- **輸出端口**：將計算結果發送到下一階段或寄存器檔。

##### 2. 總線輸入輸出模組 (BusIO)

- **功能**：負責數據在處理器內部和外部設備之間的傳輸。通常使用一組共用的數據線來連接多個設備。
- **元件**：
	- **數據總線**：傳輸數據的物理通道。
	- **控制信號**：指示數據傳輸的方向（讀取或寫入）。
	- **選擇器**：決定哪個設備應該與總線進行通訊。

##### 3. 比較器 (CMP)

- **功能**：用於比較兩個數字的大小，常用於分支指令的判斷。
- **元件**：
	- **比較邏輯**：根據輸入的數字進行比較，輸出結果（如等於、不等於、大於、小於等）。
	- **控制信號**：提供比較結果的狀態給控制單元，以決定下一步的操作。

##### 4. 控制與狀態寄存器 (CSR)

- **功能**：儲存處理器的狀態信息和控制信息，供控制單元使用。
- **元件**：
	- **狀態寄存器**：存儲執行過程中的狀態（如中斷、特權模式等）。
	- **控制信號**：根據狀態寄存器的值，控制處理器的操作。

##### 5. 寄存器檔 (RegFile)

- **功能**：儲存處理器的臨時數據，允許指令在執行過程中快速讀取和寫入。
- **元件**：
	- **多端口設計**：允許同時進行多次讀取和寫入操作，通常設計為可讀寫的多個寄存器。
	- **控制邏輯**：根據指令提供的寄存器地址，選擇相應的寄存器進行數據存取。

##### 6. 總線輸入輸出 (BusIO) 再次提及

- **功能**：除了上面提到的總線輸入輸出模組外，總線也可能涉及外部設備，如顯示器、鍵盤等。
- **元件**：
	- **外部設備控制器**：控制與外部設備之間的數據傳輸。
	- **中斷控制器**：用於處理外部設備的中斷請求。

##### 模組之間的協作

這些基本模組通過控制信號和數據總線相互連接，形成一個完整的處理器架構。例如，在執行一條加法指令時：

1. **指令解碼階段**：從寄存器檔讀取操作數，並將操作數發送到 ALU。
2. **執行階段**：ALU 接收操作數並進行加法運算，然後將結果傳送回寄存器檔。
3. **寫回階段**：將運算結果寫入寄存器檔的指定位置。

這樣的設計使得各個模組之間可以高效地協作，以支持處理器的高效運行。接下來，我們將深入探討管線的實現細節，以及如何設計和模擬這些基本模組。