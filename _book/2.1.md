#### 2.1 組合語言的基本概念

組合語言（Assembly Language）是介於高階編程語言和機器語言之間的一種低階編程語言。它以人類可讀的形式表示處理器的機器指令，能讓開發者直接操作硬體資源，如暫存器、記憶體和I/O設備。組合語言的設計目的在於提供對硬體的精確控制，從而使程式設計師能夠更有效率地利用硬體資源，並進行性能優化。

本節將介紹組合語言的基本結構、指令格式及其核心概念，幫助讀者建立對組合語言的理解。

##### 1. 組合語言的基本特徵

- **低階性**：組合語言與機器語言有著一對一的對應關係，每條組合語言指令通常對應於一條機器碼指令。這使得組合語言能夠直接控制處理器的每個操作。

- **人類可讀性**：雖然組合語言仍然與高階語言相比較為難以理解，但它使用簡單的助記符（mnemonics）替代機器碼，使得程式碼對開發者來說更具可讀性。這些助記符通常由指令名及其操作數組成。

- **平台依賴性**：每種處理器架構（如 RISC-V、x86、ARM）都有其專屬的組合語言，這使得組合語言具有高度的平台依賴性，開發者需熟悉特定處理器的指令集。

##### 2. 指令的類型

組合語言中的指令大致可分為以下幾類：

- **數據傳輸指令**：用於在暫存器和記憶體之間傳輸數據。例如，RISC-V 中的 `lw`（load word）指令將數據從記憶體載入到暫存器，而 `sw`（store word）指令則將數據從暫存器存儲到記憶體。

- **算術運算指令**：用於執行數學運算，如加法、減法、乘法和除法。在 RISC-V 中，`add` 用於加法操作，`sub` 用於減法。

- **邏輯運算指令**：用於進行邏輯運算，例如與（AND）、或（OR）和非（NOT）。這些指令在處理二進位數據時非常有用。

- **控制流程指令**：用於控制程式執行的流程，包括跳轉和條件跳轉指令。在 RISC-V 中，`jal`（jump and link）指令用於無條件跳轉，而 `beq`（branch if equal）則用於根據條件進行跳轉。

##### 3. 組合語言的基本結構

組合語言的程式通常由以下幾個部分組成：

1. **段定義**：每個組合語言程式通常由不同的段組成，如 `.data` 段（數據段）和 `.text` 段（程式碼段）。數據段用於定義程式中使用的變量和常數，程式碼段則包含執行的指令。

   ```assembly
   .section .data
   message: .asciz "Hello, World!"

   .section .text
   .globl _start
   ```

2. **標籤**：標籤用於標識程式中的特定位置，方便跳轉或引用。標籤通常位於指令之前，並以冒號結尾。

   ```assembly
   start:
       li a0, 1    # 將 1 加載到暫存器 a0
       ...
   ```

3. **指令**：每條指令包含操作碼（opcode）和操作數（operands）。操作碼是指令的名稱，表示要執行的操作；操作數則是指令所需的數據或地址。

   ```assembly
   add a0, a1, a2  # 將 a1 和 a2 的值相加，結果存入 a0
   ```

##### 4. 組合語言的優缺點

- **優點**：
  - 高效能：由於組合語言直接對應於硬體指令，因此其執行效率通常高於高階語言。
  - 精細控制：開發者能夠精確控制每一個硬體操作，包括記憶體管理、I/O 操作等。

- **缺點**：
  - 可讀性差：與高階語言相比，組合語言的可讀性較差，程式碼通常難以理解和維護。
  - 跨平台問題：組合語言是平台依賴的，無法直接在不同架構上運行。

#### 總結

組合語言是硬體編程的基石，它允許開發者直接控制處理器的行為，並進行底層的優化。理解組合語言的基本概念和結構，能夠幫助讀者在接下來的章節中更好地掌握 RISC-V 的指令集和工具鏈的使用。透過組合語言的學習，讀者將能夠深入理解計算機系統的運作原理，並為嵌入式系統和高性能應用的開發打下堅實的基礎。